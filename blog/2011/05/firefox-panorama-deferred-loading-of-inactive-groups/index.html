
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Deferred loading of inactive tab groups - Tim Taubert</title>
    
    <meta name="description" content="Deferred loading of inactive tab groups May 20, 2011 Starting with tomorrow’s Nightly hidden tabs are not anymore restored by default when starting &hellip;">
    <meta content="Tim Taubert" name="author">
    <link href="/stylesheets/bootstrap.min.css" media="screen" rel="stylesheet" type="text/css">
    <link href="/stylesheets/screen.min.css" media="screen" rel="stylesheet" type="text/css">
    <link href="/stylesheets/tables.css" media="screen" rel="stylesheet" type="text/css">
    <link href="/favicon.ico" rel="icon" type="image/ico">
    <link href="/atom.xml" rel="alternate" title="Tim Taubert" type="application/atom+xml">
  </head>


<body>
  <section id="wrapper">
    <nav class="navbar navbar-static-top">
  <div class="container">
    <div class="navbar-header">
      <a class="navbar-brand" href="/">Tim Taubert</a>
    </div>
    <div id="navbar">
      <ul class="nav navbar-nav navbar-right">
        <li><a href="/">Blog</a></li>
        <li><a href="/talks">Talks</a></li>
        <li><a href="https://twitter.com/ttaubert">Twitter</a></li>
        <li><a href="https://github.com/ttaubert">GitHub</a></li>
      </ul>
    </div>
  </div>
</nav>

    <article>
  <header id="article-header">
    <div class="container">
      <h1>Deferred loading of inactive tab groups</h1>
      <h2></h2>
    </div>
  </header>

  <div class="container">
    <time pubdate="pubdate">May 20, 2011</time>
    <p>Starting with tomorrow’s Nightly hidden tabs are not anymore restored by default when starting Firefox. That means tabs from inactive Panorama groups will not load until these groups/tabs are shown. Finally we have a part of the behavior everyone actually expects when using Panorama.</p>

<p>If you have lots of tabs and tab groups like me (~120 tabs in 12 groups) the landing of <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=595601" title="Bug 595601 - Option to not load tabs from inactive groups on initial browser startup (and until such time as the tab(s) become part of an active group)">bug 595601</a> for Firefox 6 is going to be a huge win in terms of (perceived) startup speed and memory usage. But let’s check the numbers.</p>

<p><a href="/images/panorama.png" title="Panorama with lots of groups" class="img"><img src="/images/panorama.png" title="Panorama with lots of groups" ></a></p>

<h2>Memory Usage (with hidden tabs restored)</h2>

<p>Remember: all tabs are restored and rendered regardless of whether they’re hidden or not. JavaScripts, plugins and the like are executed, too.</p>

<figure class='code'><div class="highlight"><pre>Mapped Memory
2,066.92 MB (100.0%) -- mapped
├──1,288.00 MB (62.31%) -- heap
├────679.80 MB (32.89%) -- other
└─────99.12 MB (04.80%) -- js
├──94.49 MB (04.57%) -- mjit-code
└───4.63 MB (00.22%) -- tjit-code

Used Heap Memory
1,264.93 MB (100.0%) -- heap-used
├────574.40 MB (45.41%) -- other
├────405.63 MB (32.07%) -- js
├────199.56 MB (15.78%) -- images
├─────61.39 MB (04.85%) -- layout
├─────21.25 MB (01.68%) -- storage
└──────2.70 MB (00.21%) -- gfx
└──2.70 MB (00.21%) -- surface
└──2.70 MB (00.21%) -- image
</pre></div></figure>


<h2>Memory Usage (no hidden tabs restored)</h2>

<p>The tabs are technically still present but haven’t been restored and therefore they’re not loaded or rendered and no JavaScripts and plugins are executed until they’re shown.</p>

<figure class='code'><div class="highlight"><pre>Mapped Memory
920.39 MB (100.0%) -- mapped
├──586.25 MB (63.70%) -- other
├──317.00 MB (34.44%) -- heap
└───17.14 MB (01.86%) -- js
├──16.52 MB (01.79%) -- mjit-code
└───0.63 MB (00.07%) -- tjit-code

Used Heap Memory
283.59 MB (100.0%) -- heap-used
├──146.84 MB (51.78%) -- other
├──119.16 MB (42.02%) -- js
├────6.74 MB (02.38%) -- layout
├────5.40 MB (01.91%) -- storage
├────5.33 MB (01.88%) -- images
└────0.12 MB (00.04%) -- (1 omitted)
</pre></div></figure>


<h2>Startup Time</h2>

<p>When we would try to measure startup times with <a href="https://addons.mozilla.org/en-US/firefox/addon/about-startup/">about:startup</a> we would probably see no big difference. This is because the patch does not change how the whole session is restored but when every single tab is. So our visible tabs get restored a bit faster and they are earlier available for user interaction (because no tab in the background disturbs with network or CPU usage). Bonus: hidden tabs with auto-play stuff can’t annoy you anymore (looking at you, Youtube!).</p>

<p>The test setup includes a visible group (out of 12) with 4 normal tabs (out of 120) and 4 pinned tabs (including Google Groups, Twitter and Facebook). I simply started the timer when I could see the browser window and stopped it when every visible tab finished loading.</p>

<figure class='code'><div class="highlight"><pre>Startup time (before)  - 17.5s (avg)
Startup time (after)   - 13.5s (avg)
</pre></div></figure>


<p>We only see a small win here but that’s no surprise as the session restore component already does a pretty clever job in prioritizing visible tabs higher than hidden tabs and we have also a lot of prioritization at networking level.</p>

<h2>What’s next?</h2>

<p>The next thing we probably should address is the hibernation of entire tab groups that haven’t been used for a while because there are lots of people out there who tend to never close their browsers (like me, yeah) – but that’s another bug.</p>

  </div>
</article>

  </section>

  <footer>
  <div class="container">
    <span class="break">&#8203;</span><div class="section">
      <a class="main" href="/">Tim Taubert</a>
      <span class="job">Security &amp; Crypto Engineer</span>
      <a class="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a>
      <a href="https://twitter.com/ttaubert">@ttaubert</a>
    </div>
    <span class="break">&#8203;</span><div class="section short1">
      <span class="job">Security &amp; Crypto Engineer</span>
      <a class="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a>
      <a href="https://twitter.com/ttaubert">@ttaubert</a>
    </div>
    <span class="break">&#8203;</span><div class="section short2">
      <a class="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a>
      <a href="https://twitter.com/ttaubert">@ttaubert</a>
    </div>
    <div class="section short3">
      <a class="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a>
    </div>
  </div>
</footer>

</body>
</html>
